<div class="space-y-8 animate-fade-in max-w-7xl mx-auto pb-12 p-6">
  
  <div class="flex justify-between items-center border-b border-slate-200 pb-6">
    <div>
       <h1 class="text-3xl font-bold text-slate-800">{{ 'admin.title' | translate }}</h1>
       <p class="text-slate-500">{{ 'admin.subtitle' | translate }}</p>
    </div>
    <div class="flex bg-white rounded-lg border border-slate-200 p-1">
        <button (click)="setTab('analytics')" class="px-4 py-2 text-sm font-bold rounded-md transition"
                [class.bg-slate-800]="activeTab() === 'analytics'" [class.text-white]="activeTab() === 'analytics'"
                [class.text-slate-500]="activeTab() !== 'analytics'">{{ 'admin.tabs.analytics' | translate }}</button>
        <button (click)="setTab('content')" class="px-4 py-2 text-sm font-bold rounded-md transition"
                [class.bg-slate-800]="activeTab() === 'content'" [class.text-white]="activeTab() === 'content'"
                [class.text-slate-500]="activeTab() !== 'content'">{{ 'admin.tabs.cms' | translate }}</button>
    </div>
  </div>

  @if (activeTab() === 'analytics') {
     <div class="grid grid-cols-1 md:grid-cols-4 gap-6 animate-fade-in">
        <!-- KPI Cards (Clickable) -->
        <div (click)="selectMetric('users')" class="bg-white p-6 rounded-xl shadow-sm border cursor-pointer hover:shadow-md transition"
             [class.border-emerald-500]="selectedMetric() === 'users'" [class.border-slate-100]="selectedMetric() !== 'users'">
            <p class="text-xs font-bold text-slate-400 uppercase">{{ 'admin.kpi.users' | translate }}</p>
            <p class="text-3xl font-bold text-slate-800 mt-2">{{ stats().totalUsers }}</p>
            <div class="text-emerald-500 text-xs font-bold mt-1"><i class="fa-solid fa-arrow-trend-up"></i> +12%</div>
        </div>
        <div (click)="selectMetric('active')" class="bg-white p-6 rounded-xl shadow-sm border cursor-pointer hover:shadow-md transition"
             [class.border-emerald-500]="selectedMetric() === 'active'" [class.border-slate-100]="selectedMetric() !== 'active'">
            <p class="text-xs font-bold text-slate-400 uppercase">{{ 'admin.kpi.active' | translate }}</p>
            <p class="text-3xl font-bold text-slate-800 mt-2">{{ stats().dailyActive }}</p>
            <p class="text-slate-400 text-xs mt-1">~24% engagement</p>
        </div>
        <div (click)="selectMetric('db')" class="bg-white p-6 rounded-xl shadow-sm border cursor-pointer hover:shadow-md transition"
             [class.border-emerald-500]="selectedMetric() === 'db'" [class.border-slate-100]="selectedMetric() !== 'db'">
            <p class="text-xs font-bold text-slate-400 uppercase">{{ 'admin.kpi.db' | translate }}</p>
            <p class="text-3xl font-bold text-blue-600 mt-2">{{ stats().databaseSize }}</p>
            <p class="text-slate-400 text-xs mt-1">Scaling ok</p>
        </div>
        <div (click)="selectMetric('cost')" class="bg-white p-6 rounded-xl shadow-sm border cursor-pointer hover:shadow-md transition"
             [class.border-emerald-500]="selectedMetric() === 'cost'" [class.border-slate-100]="selectedMetric() !== 'cost'">
            <p class="text-xs font-bold text-slate-400 uppercase">{{ 'admin.kpi.cost' | translate }}</p>
            <p class="text-3xl font-bold text-slate-800 mt-2">{{ stats().estCost }}</p>
            <p class="text-slate-400 text-xs mt-1">Projected</p>
        </div>

        <!-- Dynamic Chart -->
        <div class="md:col-span-4 bg-white p-6 rounded-xl shadow-sm border border-slate-100">
            <div class="flex flex-col md:flex-row justify-between items-center mb-6">
                <h3 class="font-bold text-slate-800 flex items-center gap-2">
                    <i class="fa-solid fa-chart-bar text-emerald-500"></i>
                    {{ 'admin.chart_title' | translate }}: {{ 'admin.kpi.' + selectedMetric() | translate }}
                </h3>
                
                <!-- Timeframe Selector -->
                <div class="flex gap-2 mt-2 md:mt-0 bg-slate-100 p-1 rounded-lg">
                    <button (click)="setTimeframe('1w')" class="px-3 py-1 text-xs font-bold rounded transition"
                        [class.bg-white]="growthTimeframe() === '1w'" [class.shadow-sm]="growthTimeframe() === '1w'" [class.text-slate-800]="growthTimeframe() === '1w'" [class.text-slate-500]="growthTimeframe() !== '1w'">1W</button>
                    <button (click)="setTimeframe('1m')" class="px-3 py-1 text-xs font-bold rounded transition"
                        [class.bg-white]="growthTimeframe() === '1m'" [class.shadow-sm]="growthTimeframe() === '1m'" [class.text-slate-800]="growthTimeframe() === '1m'" [class.text-slate-500]="growthTimeframe() !== '1m'">1M</button>
                    <button (click)="setTimeframe('6m')" class="px-3 py-1 text-xs font-bold rounded transition"
                        [class.bg-white]="growthTimeframe() === '6m'" [class.shadow-sm]="growthTimeframe() === '6m'" [class.text-slate-800]="growthTimeframe() === '6m'" [class.text-slate-500]="growthTimeframe() !== '6m'">6M</button>
                    <button (click)="setTimeframe('1y')" class="px-3 py-1 text-xs font-bold rounded transition"
                        [class.bg-white]="growthTimeframe() === '1y'" [class.shadow-sm]="growthTimeframe() === '1y'" [class.text-slate-800]="growthTimeframe() === '1y'" [class.text-slate-500]="growthTimeframe() !== '1y'">1Y</button>
                </div>
            </div>

            <div class="h-72 flex items-end gap-1 justify-between px-4 pb-6 border-b border-slate-50">
                @for(point of chartData; track $index) {
                    <div class="w-full flex flex-col justify-end items-center group relative h-full">
                        <!-- Tooltip: High Z-Index, absolute positioning relative to bar group -->
                        <div class="absolute -top-10 left-1/2 -translate-x-1/2 bg-slate-800 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition pointer-events-none z-50 whitespace-nowrap shadow-lg font-bold">
                            {{ getMetricLabel(point.value) }}
                            <!-- Triangle for tooltip -->
                            <div class="absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-slate-800"></div>
                        </div>
                        
                        <!-- Bar (Color changes based on metric) -->
                        <div class="w-full rounded-t-sm hover:opacity-80 transition cursor-pointer" 
                             [class.bg-emerald-500]="selectedMetric() === 'users'"
                             [class.bg-blue-500]="selectedMetric() === 'active'"
                             [class.bg-purple-500]="selectedMetric() === 'db'"
                             [class.bg-orange-500]="selectedMetric() === 'cost'"
                             [style.height]="getGrowthHeight(point.value)"></div>
                        
                        <!-- Label -->
                        <div class="text-[10px] text-slate-400 mt-2 h-4 w-full text-center overflow-visible whitespace-nowrap font-medium absolute -bottom-6">
                            {{ point.label }}
                        </div>
                    </div>
                }
            </div>
        </div>
     </div>
  }

  @if (activeTab() === 'content') {
     <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 animate-fade-in">
        
        <!-- Form -->
        <div class="lg:col-span-1 bg-white p-6 rounded-xl shadow-sm border border-slate-100 h-fit sticky top-4">
            <h3 class="font-bold text-slate-800 mb-4 border-b pb-2">
                {{ (editingArticleId() ? 'admin.cms.edit_title' : 'admin.cms.create_title') | translate }}
            </h3>
            
            <form [formGroup]="articleForm" (ngSubmit)="submitArticle()" class="space-y-4">
                <div>
                    <label class="block text-xs font-bold text-slate-500 mb-1">{{ 'admin.cms.form.title' | translate }}</label>
                    <input formControlName="title" type="text" 
                           class="w-full border border-slate-300 rounded p-2 text-sm bg-white text-slate-900 placeholder-slate-400 focus:ring-2 focus:ring-slate-800 outline-none">
                </div>
                <div class="grid grid-cols-2 gap-2">
                    <div>
                        <label class="block text-xs font-bold text-slate-500 mb-1">{{ 'admin.cms.form.category' | translate }}</label>
                        <select formControlName="category" class="w-full border border-slate-300 rounded p-2 text-sm bg-white text-slate-900 focus:ring-2 focus:ring-slate-800 outline-none">
                            <option value="islamic">Islamic</option>
                            <option value="science">Science</option>
                            <option value="practical">Practical</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 mb-1">{{ 'admin.cms.form.read_time' | translate }}</label>
                        <input formControlName="readTime" type="text" 
                               class="w-full border border-slate-300 rounded p-2 text-sm bg-white text-slate-900 placeholder-slate-400 focus:ring-2 focus:ring-slate-800 outline-none">
                    </div>
                </div>
                <div>
                    <label class="block text-xs font-bold text-slate-500 mb-1">{{ 'admin.cms.form.excerpt' | translate }}</label>
                    <textarea formControlName="excerpt" rows="2" 
                              class="w-full border border-slate-300 rounded p-2 text-sm bg-white text-slate-900 placeholder-slate-400 focus:ring-2 focus:ring-slate-800 outline-none"></textarea>
                </div>
                <div>
                    <label class="block text-xs font-bold text-slate-500 mb-1">{{ 'admin.cms.form.content' | translate }}</label>
                    <textarea formControlName="content" rows="6" 
                              class="w-full border border-slate-300 rounded p-2 text-sm bg-white text-slate-900 placeholder-slate-400 focus:ring-2 focus:ring-slate-800 outline-none"></textarea>
                </div>
                <div>
                    <label class="block text-xs font-bold text-slate-500 mb-1">{{ 'admin.cms.form.action' | translate }}</label>
                    <input formControlName="actionStep" type="text" 
                           class="w-full border border-slate-300 rounded p-2 text-sm bg-white text-slate-900 placeholder-slate-400 focus:ring-2 focus:ring-slate-800 outline-none">
                </div>
                <div class="grid grid-cols-2 gap-2">
                     <div>
                        <label class="block text-xs font-bold text-slate-500 mb-1">{{ 'admin.cms.form.icon' | translate }}</label>
                        <input formControlName="icon" type="text" 
                               class="w-full border border-slate-300 rounded p-2 text-sm bg-white text-slate-900 placeholder-slate-400 focus:ring-2 focus:ring-slate-800 outline-none">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 mb-1">{{ 'admin.cms.form.source' | translate }}</label>
                        <input formControlName="source" type="text" 
                               class="w-full border border-slate-300 rounded p-2 text-sm bg-white text-slate-900 placeholder-slate-400 focus:ring-2 focus:ring-slate-800 outline-none">
                    </div>
                </div>

                <div class="flex gap-2 pt-2">
                    @if(editingArticleId()) {
                        <button type="button" (click)="cancelEdit()" class="flex-1 bg-slate-100 text-slate-600 font-bold py-2 rounded hover:bg-slate-200 transition">
                            {{ 'admin.cms.btn.cancel' | translate }}
                        </button>
                    }
                    <button type="submit" [disabled]="articleForm.invalid" 
                            class="flex-1 bg-slate-800 text-white font-bold py-2 rounded hover:bg-slate-700 disabled:opacity-50 transition">
                        {{ (editingArticleId() ? 'admin.cms.btn.update' : 'admin.cms.btn.create') | translate }}
                    </button>
                </div>
            </form>
        </div>

        <!-- List -->
        <div class="lg:col-span-2 space-y-4">
            <h3 class="font-bold text-slate-800 mb-4">{{ 'admin.cms.list_title' | translate }}</h3>
            
            <div class="space-y-3">
                @for(article of contentService.articles(); track article.id) {
                    <div class="bg-white p-4 rounded-lg border border-slate-100 flex justify-between items-start group hover:shadow-md transition">
                        <div class="flex gap-4">
                            <div class="w-10 h-10 rounded bg-slate-100 flex items-center justify-center text-slate-500">
                                <i class="fa-solid" [class]="article.icon"></i>
                            </div>
                            <div>
                                <div class="flex items-center gap-2">
                                    <span class="text-xs font-bold uppercase px-2 py-0.5 rounded"
                                        [class.bg-emerald-100]="article.category === 'islamic'" [class.text-emerald-700]="article.category === 'islamic'"
                                        [class.bg-blue-100]="article.category === 'science'" [class.text-blue-700]="article.category === 'science'"
                                        [class.bg-orange-100]="article.category === 'practical'" [class.text-orange-700]="article.category === 'practical'">
                                        {{ article.category }}
                                    </span>
                                    @if(article.isCustom) {
                                        <span class="text-[10px] bg-slate-200 text-slate-600 px-1 rounded">{{ 'admin.cms.btn.custom' | translate }}</span>
                                    } @else {
                                        <span class="text-[10px] bg-slate-100 text-slate-400 px-1 rounded">{{ 'admin.cms.btn.system' | translate }}</span>
                                    }
                                </div>
                                <h4 class="font-bold text-slate-800 mt-1">{{ article.title || 'System Article (' + article.id + ')' }}</h4>
                                <p class="text-xs text-slate-500 line-clamp-1 mt-1">{{ article.excerpt || 'Translated content' }}</p>
                            </div>
                        </div>
                        
                        <div class="flex gap-1">
                            <button (click)="editArticle(article)" class="text-slate-300 hover:text-blue-600 p-2 transition" title="Edit">
                                <i class="fa-solid fa-pen"></i>
                            </button>
                            <button (click)="deleteArticle(article.id)" class="text-slate-300 hover:text-red-500 p-2 transition" title="Delete">
                                <i class="fa-solid fa-trash"></i>
                            </button>
                        </div>
                    </div>
                }
            </div>
        </div>
     </div>
  }
</div>